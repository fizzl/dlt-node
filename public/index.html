<html>
<head>
<title>dlt-ws test page</title>
<style>

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>
$(document).ready(function() {
 var socket = new WebSocket("ws://localhost:8080/", "dlt-json");
 socket.onmessage = function(event) {
  var packet = JSON.parse(event.data, function(key, value) {
	return value && value.type === 'Buffer' ? toAscii(value.data) : value;
  });
  var row = "<tr><td>"+packet.StandardHeader.Timestamp +
            "<td>"+packet.StandardHeader.EcuId +
            "<td>"+packet.ExtendedHeader.AppId +
            "<td>"+packet.ExtendedHeader.ContextId +
			"<td>"+parsePayload(packet.Payload);
			
  $('#container').append(row);
  window.scrollTo(0,document.body.scrollHeight);
 }
});

function toAscii(data) {
 var ret = '';
 for(i in data){
  ret += String.fromCharCode(data[i]);
 }
 return ret;
}

function parsePayload(pl) {
 var ret = "";
 if(pl.Arguments && pl.Arguments.length) {
  for(i=0;i<pl.Arguments.length;i++) {
   ret += pl.Arguments[i].Data + ",";
  }
 }
 else {
  ret += pl.Data;
 }
 return ret;
}

</script>
</head>
<body>
<table id="container" border=1>
<tr>
<th>Timestamp
<th>EcuId
<th>AppId
<th>CtxId
<th>Payload
</table>
</body>
</html>